<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Partage du butin précis</title>
<style>
  body { font-family: Arial; margin: 20px; }
  table { border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 6px 12px; text-align: right; }
  th { background: #eee; }
  input { width: 80px; text-align: right; }
</style>
</head>
<body>

<h2>Partage du butin après réparations</h2>

<table id="playersTable">
  <thead>
    <tr>
      <th>Joueur</th>
      <th>Brut</th>
      <th>Réparations</th>
      <th>Net</th>
      <th>Balance</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>Mel</td>      <td><input type="number" value="2"></td> <td><input type="number" value="2"></td> <td class="net"></td> <td class="balance"></td></tr>
    <tr><td>Steven</td>   <td><input type="number" value="3"></td> <td><input type="number" value="1"></td> <td class="net"></td> <td class="balance"></td></tr>
    <tr><td>Antoine</td>  <td><input type="number" value="5"></td> <td><input type="number" value="1"></td> <td class="net"></td> <td class="balance"></td></tr>
  </tbody>
</table>

<button onclick="calculate()">Calculer les transferts</button>

<h3>Transferts à effectuer :</h3>
<table id="transfersTable">
  <thead><tr><th>De</th><th>À</th><th>Montant</th></tr></thead>
  <tbody></tbody>
</table>

<script>
function calculate() {
  const table = document.getElementById("playersTable").tBodies[0];
  let players = [];

  // Lecture des valeurs et calcul net
  Array.from(table.rows).forEach(row => {
    const name = row.cells[0].innerText;
    const gross = parseFloat(row.cells[1].firstElementChild.value) || 0;
    const repair = parseFloat(row.cells[2].firstElementChild.value) || 0;
    const net = gross - repair;
    row.cells[3].innerText = net;
    players.push({name, gross, repair, net, balance:0});
  });

  // Calcul de la part équitable
  const totalNet = players.reduce((sum,p)=>sum+p.net,0);
  const equalShare = totalNet / players.length;

  // Calcul balance = montant que le joueur doit atteindre pour avoir sa part + réparations
  players.forEach(p => p.balance = equalShare + p.repair - p.net);

  // Affichage balances
  Array.from(table.rows).forEach((row,i)=>row.cells[4].innerText = players[i].balance);

  // Séparation créditeurs/débiteurs
  let creditors = players.filter(p => p.balance > 0).map(p => ({...p}));
  let debtors   = players.filter(p => p.balance < 0).map(p => ({...p, balance: -p.balance}));

  let transfers = [];
  let i=0,j=0;
  while(i<debtors.length && j<creditors.length){
    let debtor = debtors[i];
    let creditor = creditors[j];
    let amt = Math.min(debtor.balance, creditor.balance);
    if(amt>0){
      transfers.push({from:debtor.name,to:creditor.name,amount:amt});
      debtor.balance -= amt;
      creditor.balance -= amt;
    }
    if(debtor.balance < 0.0001) i++;
    if(creditor.balance < 0.0001) j++;
  }

  // Affichage des transferts
  const tBody = document.getElementById("transfersTable").tBodies[0];
  tBody.innerHTML = "";
  transfers.forEach(t => {
    const row = tBody.insertRow();
    row.insertCell().innerText = t.from;
    row.insertCell().innerText = t.to;
    row.insertCell().innerText = t.amount;
  });
}
</script>

</body>
</html>
