<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Butin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            color: #764ba2;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .player-section {
            margin-bottom: 20px;
        }
        
        .player {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .remove-btn:hover {
            background: #c82333;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .input-field {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input[type="number"] {
            font-weight: bold;
            color: #667eea;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #28a745;
        }
        
        .btn-secondary:hover {
            background: #218838;
        }
        
        .results {
            margin-top: 30px;
            padding: 25px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }
        
        .results h2 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        .summary {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #1976d2;
            font-size: 18px;
        }
        
        .transactions {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }
        
        .transaction {
            padding: 12px;
            margin-bottom: 10px;
            background: #fff3cd;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            font-size: 16px;
        }
        
        .transaction.positive {
            background: #d4edda;
            border-left-color: #28a745;
        }
        
        .transaction.negative {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .amount {
            font-weight: bold;
            color: #ffc107;
        }
        
        .transaction.positive .amount {
            color: #28a745;
        }
        
        .transaction.negative .amount {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öîÔ∏è Calculateur de Butin et R√©parations ‚öîÔ∏è</h1>
        
        <div class="player-section" id="playerSection"></div>
        
        <button class="btn" onclick="addPlayer()">+ Ajouter un joueur</button>
        <button class="btn btn-secondary" onclick="calculate()">üí∞ Calculer</button>
        
        <div id="results"></div>
    </div>

    <script>
        let players = [
            { name: 'Mel', loot: 10, repair: 2 },
            { name: 'Steven', loot: 10, repair: 2 },
            { name: 'Antoine', loot: 10, repair: 4 }
        ];
        
        function renderPlayers() {
            const section = document.getElementById('playerSection');
            section.innerHTML = '';
            
            players.forEach((player, index) => {
                const div = document.createElement('div');
                div.className = 'player';
                div.innerHTML = `
                    <div class="player-header">
                        <span class="player-name">Joueur ${index + 1}</span>
                        ${players.length > 1 ? `<button class="remove-btn" onclick="removePlayer(${index})">Supprimer</button>` : ''}
                    </div>
                    <div class="input-group">
                        <div class="input-field">
                            <label>Nom</label>
                            <input type="text" value="${player.name}" onchange="updatePlayer(${index}, 'name', this.value)">
                        </div>
                        <div class="input-field">
                            <label>Valeur du butin (silver)</label>
                            <input type="number" value="${player.loot}" onchange="updatePlayer(${index}, 'loot', parseFloat(this.value) || 0)">
                        </div>
                        <div class="input-field">
                            <label>R√©parations (silver)</label>
                            <input type="number" value="${player.repair}" onchange="updatePlayer(${index}, 'repair', parseFloat(this.value) || 0)">
                        </div>
                    </div>
                `;
                section.appendChild(div);
            });
        }
        
        function addPlayer() {
            players.push({ name: `Joueur ${players.length + 1}`, loot: 0, repair: 0 });
            renderPlayers();
        }
        
        function removePlayer(index) {
            if (players.length > 1) {
                players.splice(index, 1);
                renderPlayers();
            }
        }
        
        function updatePlayer(index, field, value) {
            players[index][field] = value;
        }
        
        function calculate() {
            const totalLoot = players.reduce((sum, p) => sum + p.loot, 0);
            const totalRepair = players.reduce((sum, p) => sum + p.repair, 0);
            const numPlayers = players.length;
            
            const lootPerPerson = totalLoot / numPlayers;
            const repairPerPerson = totalRepair / numPlayers;
            
            // Calcul de la balance pour chaque joueur
            const balances = players.map(p => {
                const shouldHave = lootPerPerson - repairPerPerson;
                const actuallyHas = p.loot - p.repair;
                const balance = actuallyHas - shouldHave;
                
                console.log(`${p.name}: actuallyHas=${actuallyHas}, shouldHave=${shouldHave}, balance=${balance}`);
                
                return {
                    name: p.name,
                    loot: p.loot,
                    repair: p.repair,
                    balance: balance
                };
            });
            
            // Copier les balances pour le calcul des transactions
            let givers = balances.filter(b => b.balance > 0.01).map(b => ({...b})).sort((a, b) => b.balance - a.balance);
            let receivers = balances.filter(b => b.balance < -0.01).map(b => ({...b})).sort((a, b) => a.balance - b.balance);
            
            const transactions = [];
            
            for (let giver of givers) {
                let remaining = giver.balance;
                
                for (let receiver of receivers) {
                    if (remaining < 0.01) break;
                    if (receiver.balance > -0.01) continue;
                    
                    const amount = Math.min(remaining, -receiver.balance);
                    transactions.push({
                        from: giver.name,
                        to: receiver.name,
                        amount: amount
                    });
                    
                    remaining -= amount;
                    receiver.balance += amount;
                }
            }
            
            displayResults(totalLoot, totalRepair, lootPerPerson, repairPerPerson, balances, transactions);
        }
        
        function displayResults(totalLoot, totalRepair, lootPerPerson, repairPerPerson, balances, transactions) {
            const resultsDiv = document.getElementById('results');
            
            let html = `
                <div class="results">
                    <h2>üìä R√©sultats</h2>
                    
                    <div class="summary">
                        <div class="summary-item">
                            <span>Butin total :</span>
                            <span><strong>${totalLoot.toFixed(2)}</strong> silver</span>
                        </div>
                        <div class="summary-item">
                            <span>R√©parations totales :</span>
                            <span><strong>${totalRepair.toFixed(2)}</strong> silver</span>
                        </div>
                        <div class="summary-item">
                            <span>Part de butin par personne :</span>
                            <span><strong>${lootPerPerson.toFixed(2)}</strong> silver</span>
                        </div>
                        <div class="summary-item">
                            <span>Part de r√©paration par personne :</span>
                            <span><strong>${repairPerPerson.toFixed(2)}</strong> silver</span>
                        </div>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0; color: #1976d2;">Soldes individuels :</h3>
                    <div class="transactions">
            `;
            
            balances.forEach(b => {
                const className = b.balance > 0.01 ? 'positive' : (b.balance < -0.01 ? 'negative' : '');
                const sign = b.balance > 0 ? '+' : '';
                html += `
                    <div class="transaction ${className}">
                        <strong>${b.name}</strong> : 
                        <span class="amount">${sign}${b.balance.toFixed(2)}</span> silver
                        <span style="color: #666; font-size: 14px;">
                            (butin: ${b.loot}, r√©pa: ${b.repair})
                        </span>
                    </div>
                `;
            });
            
            html += `</div>`;
            
            if (transactions.length > 0) {
                html += `
                    <h3 style="margin: 20px 0 10px 0; color: #1976d2;">üí∏ Transactions √† effectuer :</h3>
                    <div class="transactions">
                `;
                
                transactions.forEach(t => {
                    html += `
                        <div class="transaction">
                            <strong>${t.from}</strong> doit donner 
                            <span class="amount">${t.amount.toFixed(2)} silver</span> 
                            √† <strong>${t.to}</strong>
                        </div>
                    `;
                });
                
                html += `</div>`;
            } else {
                html += `
                    <h3 style="margin: 20px 0 10px 0; color: #28a745;">‚úÖ Tout est √©quilibr√© !</h3>
                    <p>Aucune transaction n√©cessaire.</p>
                `;
            }
            
            html += `</div>`;
            
            resultsDiv.innerHTML = html;
        }
        
        renderPlayers();
    </script>
</body>
</html>
